var grey="rgb(205,201,201)",white="rgb(255,255,255)",black="rgb(0,0,0)",red="rgb(255,0,0)",paused="p",started="s",finished="f",flag="f",ready="r",clicked="c",none="";
$().ready(function(){document.getElementById("panel").oncontextmenu=function(){return false};setSettings();var e=document.getElementById("panel").getContext("2d");e.fillStyle=black;e.strokeStyle=black;e.lineWidth=2;$("#panel");var d=new Image;d.src="images/Flag.gif";$("#status").html("Waiting");setUpPanel();$("#panel").mousedown(function(b){if(b.button==2){if(started===getGameState()){var c=getCell(b),b=c.x,c=c.y;if(ready===getCellState(b,c))e.drawImage(d,b*48+1,c*48+1),setCellState(b,c,flag);else if(flag===
getCellState(b,c))e.fillStyle=white,e.fillRect(b*48+1,c*48+1,46,46),setCellState(b,c,ready)}return false}return true});$("#panel").click(function(b){if(started===getGameState()){var b=getCell(b),c=b.x,a=b.y;setTimeout(function(){if(ready===getCellState(c,a)){"MINE"===getCellValue(c,a)?(fillMines(),e.fillStyle=red):e.fillStyle=grey;e.fillRect(c*48+1,a*48+1,46,46);e.fillStyle=black;var b=getCellValue(c,a);e.fillText(b=="0"?"":b,c*48+24,a*48+24);setCellState(c,a,clicked)}},250)}});newGame();$("#newgame").click(newGame)});
function fillMines(){for(var e=graph.getContext("2d"),d=sessionStorage.numCols,b=sessionStorage.numRows,c=0;c<b;c++)for(var a=0;a<d;a++)if("MINE"===getCellValue(c,a))e.fillStyle=red,e.fillRect(c*cellSize+1,a*cellSize+1,cellSize-2,cellSize-2),e.fillStyle=black,e.fillText("MINE",c*cellSize+0.5*cellSize,a*cellSize+0.5*cellSize);setGameState(finished);$("#status").html("Finished")}
function setUpPanel(){var e=document.getElementById("panel"),d=e.getContext("2d");d.fillStyle=black;d.strokeStyle=black;d.lineWidth=2;var b=sessionStorage.numRows,c=sessionStorage.numCols,a=$("#panel");$("#panel").ready(function(){e.setAttribute("width",48*c);e.setAttribute("height",48*b);for(var f=1;f<c;f++)d.beginPath(),d.moveTo(a.width()/c*f,0),d.lineTo(a.width()/c*f,a.height()),d.stroke(),d.closePath();for(f=1;f<b;f++)d.beginPath(),d.moveTo(0,a.height()/b*f),d.lineTo(a.width(),a.height()/b*f),
d.stroke(),d.closePath();d.textAlign="center";d.font="2em";d.textBaseline="middle";a.css("font-size","2em")})}function getCell(e){var d=$("#panel"),b=sessionStorage.offsetLeft,c=sessionStorage.offsetTop,a=sessionStorage.numCols,f=sessionStorage.numRows,b=a-(d.width()-(e.pageX-b))/(d.width()/a),e=f-(d.height()-(e.pageY-c))/(d.height()/f),d={};d.x=Math.floor(b);d.y=Math.floor(e);return d}
function setSettings(){sessionStorage.numRows=9;sessionStorage.numCols=9;sessionStorage.offsetTop=$("#panel").offset().top;sessionStorage.offsetLeft=$("#panel").offset().left}
function newGame(){setUpPanel();for(var e=sessionStorage.numRows,d=sessionStorage.numCols,b=0;b<e;b++)for(var c=0;c<d;c++)setCellState(c,b,none),setCellValue(c,b,none);var a=generateBoard(e,d),f=$("#text"),g=[];g.push("<table id='test'>");for(b=0;b<e;b++){g.push("<tr>");for(c=0;c<d;c++)g.push("<td>("+b+","+c+")<br />"+a.locations[b][c].value+"</td>"),setCellValue(c,b,a.locations[b][c].value),setCellState(c,b,ready);g.push("</tr>")}g.push("</table>");f.html(g.join(""));f.hide();$("#status").html("Started");
setGameState(started)}
function generateBoard(e,d){for(var b={locations:[]},c=0;c<d;c++){for(var a=[],f=0;f<e;f++)a.push({value:0});b.locations.push(a)}f=[];for(c=0;c<9;c++){a={};do a.x=Math.floor(Math.random()*d),a.y=Math.floor(Math.random()*e);while(b.locations[a.x][a.y].value==="MINE");f.push(a);b.locations[a.x][a.y].value="MINE";a.x-1>=0&&(b.locations[a.x-1][a.y].value!=="MINE"&&b.locations[a.x-1][a.y].value++,a.y-1>=0&&b.locations[a.x-1][a.y-1].value!=="MINE"&&b.locations[a.x-1][a.y-1].value++,a.y+1<e&&b.locations[a.x-
1][a.y+1].value!=="MINE"&&b.locations[a.x-1][a.y+1].value++);a.y-1>=0&&b.locations[a.x][a.y-1].value!=="MINE"&&b.locations[a.x][a.y-1].value++;a.y+1<e&&b.locations[a.x][a.y+1].value!=="MINE"&&b.locations[a.x][a.y+1].value++;a.x+1<d&&(b.locations[a.x+1][a.y].value!=="MINE"&&b.locations[a.x+1][a.y].value++,a.y-1>=0&&b.locations[a.x+1][a.y-1].value!=="MINE"&&b.locations[a.x+1][a.y-1].value++,a.y+1<e&&b.locations[a.x+1][a.y+1].value!=="MINE"&&b.locations[a.x+1][a.y+1].value++)}return b}
function getCellState(e,d){return sessionStorage["cell"+d+""+e+"state"]}function setCellState(e,d,b){sessionStorage["cell"+d+""+e+"state"]=b}function getCellValue(e,d){return sessionStorage["cell"+d+""+e+"value"]}function setCellValue(e,d,b){sessionStorage["cell"+d+""+e+"value"]=b}function setGameState(e){sessionStorage.gameState=e}function getGameState(){return sessionStorage.gameState}window.onunload=function(){setGameState(paused)};