$().ready(function(){setSettings();var e=document.getElementById("panel").getContext("2d");e.fillStyle="rgb(0,0,0)";e.strokeStyle="rgb(0,0,0)";e.lineWidth=2;$("#panel");var d=new Image;d.src="images/Flag.gif";$("#status").html("Waiting");setUpPanel();$("#panel").click(function(c){if(sessionStorage.gameState=="s"){var c=getCell(c),a=c.x,b=c.y;setTimeout(function(){if(sessionStorage["cell"+b+""+a+"state"]=="r"){if(sessionStorage["cell"+b+""+a+"value"]=="MINE"){for(var c=sessionStorage.numCols,d=sessionStorage.numRows,
h=0;h<d;h++)for(var i=0;i<c;i++)if(sessionStorage["cell"+i+""+h+"value"]=="MINE")e.fillStyle="rgba(255,0,0,1)",e.fillRect(h*48+1,i*48+1,46,46),e.fillStyle="rgb(0,0,0)",e.fillText("MINE",h*48+24,i*48+24);sessionStorage.gameState="f";$("#status").html("Finished");e.fillStyle="rgba(255,0,0,1)"}else e.fillStyle="rgba(205,201,201,1)";e.fillRect(a*48+1,b*48+1,46,46);e.fillStyle="rgb(0,0,0)";c=sessionStorage["cell"+b+""+a+"value"];e.fillText(c=="0"?"":c,a*48+24,b*48+24);sessionStorage["cell"+b+""+a+"state"]=
"c"}},250)}});$("#panel").dblclick(function(c){if(sessionStorage.gameState=="s"){var a=getCell(c),c=a.x,a=a.y;sessionStorage["cell"+a+""+c+"state"]=="r"&&(e.drawImage(d,c*48+1,a*48+1),sessionStorage["cell"+a+""+c+"state"]="f")}});$("#newgame").click(function(){newGame()})});
function setUpPanel(){var e=document.getElementById("panel"),d=e.getContext("2d");d.fillStyle="rgb(0,0,0)";d.strokeStyle="rgb(0,0,0)";d.lineWidth=2;var c=sessionStorage.numRows,a=sessionStorage.numCols,b=$("#panel");$("#panel").ready(function(){e.setAttribute("width",48*a);e.setAttribute("height",48*c);for(var f=1;f<a;f++)d.beginPath(),d.moveTo(b.width()/a*f,0),d.lineTo(b.width()/a*f,b.height()),d.stroke(),d.closePath();for(f=1;f<c;f++)d.beginPath(),d.moveTo(0,b.height()/c*f),d.lineTo(b.width(),b.height()/
c*f),d.stroke(),d.closePath();d.textAlign="center";d.font="2em";d.textBaseline="middle";b.css("font-size","2em")})}function getCell(e){var d=$("#panel"),c=sessionStorage.offsetLeft,a=sessionStorage.offsetTop,b=sessionStorage.numCols,f=sessionStorage.numRows,c=b-(d.width()-(e.pageX-c))/(d.width()/b),e=f-(d.height()-(e.pageY-a))/(d.height()/f),d={};d.x=Math.floor(c);d.y=Math.floor(e);return d}
function setSettings(){sessionStorage.numRows=9;sessionStorage.numCols=9;sessionStorage.offsetTop=$("#panel").offset().top;sessionStorage.offsetLeft=$("#panel").offset().left}
function newGame(){setUpPanel();for(var e=sessionStorage.numRows,d=sessionStorage.numCols,c=0;c<e;c++)for(var a=0;a<d;a++)sessionStorage["cell"+c+""+a+"value"]="",sessionStorage["cell"+c+""+a+"state"]="";var b=generateBoard(e,d),f=$("#text"),g=[];g.push("<table id='test'>");for(c=0;c<e;c++){g.push("<tr>");for(a=0;a<d;a++)g.push("<td>("+c+","+a+")<br />"+b.locations[c][a].value+"</td>"),sessionStorage["cell"+c+""+a+"value"]=b.locations[c][a].value,sessionStorage["cell"+c+""+a+"state"]="r";g.push("</tr>")}g.push("</table>");
f.html(g.join());f.hide();$("#status").html("Started");sessionStorage.gameState="s"}
function generateBoard(e,d){for(var c={locations:[]},a=0;a<d;a++){c.locations[a]=[];for(var b=0;b<e;b++)c.locations[a][b]={},c.locations[a][b].value=0}b=[];for(a=0;a<9;a++)b[a]={},b[a].x=Math.floor(Math.random()*d),b[a].y=Math.floor(Math.random()*e),c.locations[b[a].x][b[a].y].value="MINE",b[a].x-1>0&&(c.locations[b[a].x-1][b[a].y].value!=="MINE"&&c.locations[b[a].x-1][b[a].y].value++,b[a].y-1>0&&c.locations[b[a].x-1][b[a].y-1].value!=="MINE"&&c.locations[b[a].x-1][b[a].y-1].value++,b[a].y+1<e&&c.locations[b[a].x-
1][b[a].y+1].value!=="MINE"&&c.locations[b[a].x-1][b[a].y+1].value++),b[a].y-1>0&&c.locations[b[a].x][b[a].y-1].value!=="MINE"&&c.locations[b[a].x][b[a].y-1].value++,b[a].y+1<e&&c.locations[b[a].x][b[a].y+1].value!=="MINE"&&c.locations[b[a].x][b[a].y+1].value++,b[a].x+1<d&&(c.locations[b[a].x+1][b[a].y].value!=="MINE"&&c.locations[b[a].x+1][b[a].y].value++,b[a].y-1>0&&c.locations[b[a].x+1][b[a].y-1].value!=="MINE"&&c.locations[b[a].x+1][b[a].y-1].value++,b[a].y+1<e&&c.locations[b[a].x+1][b[a].y+1].value!==
"MINE"&&c.locations[b[a].x+1][b[a].y+1].value++);return c}window.onunload=function(){sessionStorage.gameState="p"};