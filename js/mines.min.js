$().ready(function(){setSettings();var b=document.getElementById("panel").getContext("2d");b.fillStyle="rgb(0,0,0)";b.strokeStyle="rgb(0,0,0)";b.lineWidth=2;$("#panel");var a=new Image;a.src="/images/Flag.gif";$("#status").html("Waiting");setUpPanel();$("#panel").click(function(d){if(sessionStorage.gameState=="s"){d=getCell(d);var c=d.x,f=d.y;setTimeout(function(){if(sessionStorage["cell"+f+""+c+"state"]=="r"){if(sessionStorage["cell"+f+""+c+"value"]=="MINE"){for(var e=sessionStorage.numCols,h=sessionStorage.numRows,
g=0;g<h;g++)for(var i=0;i<e;i++)if(sessionStorage["cell"+i+""+g+"value"]=="MINE"){b.fillStyle="rgba(255,0,0,1)";b.fillRect(g*48+1,i*48+1,46,46);b.fillStyle="rgb(0,0,0)";b.fillText("MINE",g*48+24,i*48+24)}sessionStorage.gameState="f";$("#status").html("Finished");b.fillStyle="rgba(255,0,0,1)"}else b.fillStyle="rgba(205,201,201,1)";b.fillRect(c*48+1,f*48+1,46,46);b.fillStyle="rgb(0,0,0)";e=sessionStorage["cell"+f+""+c+"value"];b.fillText(e=="0"?"":e,c*48+24,f*48+24);sessionStorage["cell"+f+""+c+"state"]=
"c"}},250)}});$("#panel").dblclick(function(d){if(sessionStorage.gameState=="s"){var c=getCell(d);d=c.x;c=c.y;if(sessionStorage["cell"+c+""+d+"state"]=="r"){b.drawImage(a,d*48+1,c*48+1);sessionStorage["cell"+c+""+d+"state"]="f"}}});$("#newgame").click(function(){newGame()})});
function setUpPanel(){var b=document.getElementById("panel"),a=b.getContext("2d");a.fillStyle="rgb(0,0,0)";a.strokeStyle="rgb(0,0,0)";a.lineWidth=2;var d=sessionStorage.numRows,c=sessionStorage.numCols,f=$("#panel");$("#panel").ready(function(){b.setAttribute("width",48*c);b.setAttribute("height",48*d);for(var e=1;e<c;e++){a.beginPath();a.moveTo(f.width()/c*e,0);a.lineTo(f.width()/c*e,f.height());a.stroke();a.closePath()}for(e=1;e<d;e++){a.beginPath();a.moveTo(0,f.height()/d*e);a.lineTo(f.width(),
f.height()/d*e);a.stroke();a.closePath()}a.textAlign="center";a.font="2em";a.textBaseline="middle";f.css("font-size","2em")})}function getCell(b){var a=$("#panel"),d=sessionStorage.offsetLeft,c=sessionStorage.offsetTop,f=sessionStorage.numCols,e=sessionStorage.numRows;d=f-(a.width()-(b.pageX-d))/(a.width()/f);b=e-(a.height()-(b.pageY-c))/(a.height()/e);a={};a.x=Math.floor(d);a.y=Math.floor(b);return a}
function setSettings(){sessionStorage.numRows=9;sessionStorage.numCols=9;sessionStorage.offsetTop=$("#panel").offset().top;sessionStorage.offsetLeft=$("#panel").offset().left}
function newGame(){setUpPanel();for(var b=sessionStorage.numRows,a=sessionStorage.numCols,d=0;d<b;d++)for(var c=0;c<a;c++){sessionStorage["cell"+d+""+c+"value"]="";sessionStorage["cell"+d+""+c+"state"]=""}$.getJSON("http://brian-reber.appspot.com/getminedata",function(f){var e=$("#text");e.html("<table>");for(var h=0;h<b;h++){e.append("<tr>");for(var g=0;g<a;g++){$("#text").append("<td>("+h+","+g+")<br />"+f.locations[h][g].value+"</td>");sessionStorage["cell"+h+""+g+"value"]=f.locations[h][g].value;sessionStorage["cell"+h+""+
g+"state"]="r"}e.append("</tr>")}e.append("</table>");e.hide()});$("#status").html("Started");sessionStorage.gameState="s"}window.onunload=function(){sessionStorage.gameState="p"};